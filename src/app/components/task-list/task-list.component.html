<ion-list>
  <ion-item *ngFor="let task of filteredTasks()" lines="full" class="task-item">

    <!-- Modo edición -->
    <div *ngIf="editingTaskId === task.id" class="edit-container" style="display: flex; align-items: center; gap: 8px;">
      <ion-input
        [(ngModel)]="editedTaskTitle"
        placeholder="Editar título"
        clearInput
        autocorrect="off"
        autocomplete="off"
        autocapitalize="sentences"
        style="flex: 1;"
      ></ion-input>

      <ion-button fill="clear" color="success" (click)="updateTask(task)" title="Guardar" size="small">
        <ion-icon name="checkmark-outline"></ion-icon>
      </ion-button>
      <ion-button fill="clear" color="medium" (click)="cancelEditing()" title="Cancelar" size="small">
        <ion-icon name="close-outline"></ion-icon>
      </ion-button>
    </div>

    <div *ngIf="editingTaskId !== task.id" class="view-container" style="display: flex; align-items: center; width: 100%; justify-content: space-between;">
      
      <ion-label class="task-info" style="flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
        <div>
          <span class="task-title" [class.completed]="task.completed">{{ task.title }}</span>
        </div>

        <div class="task-description" style="font-size: 0.9em; color: gray;">
          {{ task.description || 'Sin descripción' }}
        </div>

        <div *ngIf="task.categoryId" class="task-category" style="color: gray; font-size: 0.8em; margin-top: 2px;">
          ({{ getCategoryName(task.categoryId) }})
        </div>

        <ion-badge [color]="task.completed ? 'success' : 'warning'" style="margin-top: 4px;">
          {{ task.completed ? 'Completada' : 'Pendiente' }}
        </ion-badge>
      </ion-label>

      <ion-checkbox
        slot="end"
        [checked]="task.completed"
        (ionChange)="onToggleCompleted(task)"
        style="margin-left: 10px;"
      ></ion-checkbox>

      <ion-button fill="clear" color="primary" (click)="startEditing(task)" title="Editar" size="small" style="margin-left: 6px;">
        <ion-icon name="create-outline"></ion-icon>
      </ion-button>

      <ion-button fill="clear" color="danger" (click)="onDeleteTask(task)" title="Eliminar" size="small" style="margin-left: 6px;">
        <ion-icon name="trash-outline"></ion-icon>
      </ion-button>
    </div>
  </ion-item>
</ion-list>